<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DodoWheels 文档管理系统</title>
<style>
    body {
        margin: 0;
        font-family: 'Segoe UI', Arial, sans-serif;
        background-color: #121212;
        color: #00bfff;
    }

    /* 登录页面 */
    #loginPage {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        text-align: center;
    }
    #loginPage h1 {
        color: #1e90ff;
        margin-bottom: 20px;
    }
    #loginPage input, #loginPage button {
        width: 260px;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        border: none;
    }
    #loginPage button {
        background: linear-gradient(90deg, #1e90ff, #00bfff);
        color: white;
        font-weight: bold;
        cursor: pointer;
    }
    #errorMsg {
        color: red;
        margin-top: 10px;
        display: none;
    }

    /* 工具中心 */
    #toolPage {
        display: none;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }

    /* Tab 栏 */
    .tab-bar {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
        border-bottom: 2px solid #00bfff50;
    }
    .tab-button {
        padding: 10px 20px;
        cursor: pointer;
        background: none;
        border: none;
        color: #aaa;
        font-weight: bold;
        font-size: 1.1em;
    }
    .tab-button.active {
        color: #00bfff;
        border-bottom: 3px solid #00bfff;
    }

    /* 文件卡片 */
    .tools {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 15px;
    }
    .tool {
        background: #1c1c1c;
        border: 1px solid #00bfff50;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        box-shadow: 0 0 15px #00bfff30;
    }
    .tool h3 {
        color: #00bfff;
        font-size: 1em;
        margin-bottom: 10px;
    }
    .tool button {
        width: 100%;
        padding: 8px;
        border: none;
        border-radius: 5px;
        background: linear-gradient(90deg, #1e90ff, #00bfff);
        color: #fff;
        cursor: pointer;
    }
    .tool span {
        display: block;
        padding: 8px;
        border-radius: 5px;
        background: #444;
        color: #aaa;
    }

    /* 子文件夹标题 */
    h2.folder-title {
        color: #1e90ff;
        margin: 20px 0 10px;
        font-size: 1.2em;
        cursor: pointer;
        user-select: none;
    }
    h2.folder-title::before {
        content: "▶ ";
        font-size: 0.9em;
    }
    h2.folder-title.expanded::before {
        content: "▼ ";
    }
    .folder-content {
        margin-left: 10px;
        display: none;
    }

    /* 一键按钮 + 搜索框 */
    .tab-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 10px 0 20px;
    }
    .tab-controls input {
        padding: 8px 12px;
        border-radius: 5px;
        border: 1px solid #00bfff50;
        background: #1c1c1c;
        color: #00bfff;
        width: 200px;
    }
    .tab-controls button {
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        background: linear-gradient(90deg, #1e90ff, #00bfff);
        color: #fff;
        cursor: pointer;
        font-weight: bold;
    }

    /* 搜索高亮 */
    mark {
        background: none;
        color: #1e90ff;
        font-weight: bold;
    }
</style>
</head>
<body>

<!-- 登录页面 -->
<div id="loginPage">
    <img src="logo.png" alt="DodoWheels Logo" style="width:120px; margin-bottom:20px;">
    <h1>DodoWheels 文档管理系统</h1>
    <input type="text" id="username" placeholder="用户名">
    <input type="password" id="password" placeholder="密码">
    <button onclick="login()">登录</button>
    <div id="errorMsg">用户名或密码错误</div>
</div>

<!-- 工具中心 -->
<div id="toolPage">
    <h1>DodoWheels 文档管理系统</h1>
    <div class="tab-bar" id="tabBar"></div>
    <div id="tabContent"></div>
</div>

<script>
let currentUser = null;
let users = {};
let files = {};

// 登录函数
async function login() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const errorMsg = document.getElementById("errorMsg");

    if (!Object.keys(users).length) {
        const res = await fetch("users.json");
        users = await res.json();
    }

    if (users[username] && users[username].password === password) {
        currentUser = users[username];
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("toolPage").style.display = "block";
        loadFiles();
    } else {
        errorMsg.style.display = "block";
    }
}

// 加载文件配置
async function loadFiles() {
    const res = await fetch("files.json");
    files = await res.json();
    renderTabs();
}

// 渲染 Tab
function renderTabs() {
    const tabBar = document.getElementById("tabBar");
    tabBar.innerHTML = "";

    currentUser.tabs.forEach((tab, idx) => {
        const btn = document.createElement("button");
        btn.className = "tab-button" + (idx === 0 ? " active" : "");
        btn.innerText = tab.label;
        btn.onclick = () => showTab(tab.key, btn);
        tabBar.appendChild(btn);
    });

    showTab(currentUser.tabs[0].key, tabBar.children[0]);
}

// 渲染文件卡片
function showTab(tabKey, btn) {
    document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    const tabContent = document.getElementById("tabContent");
    tabContent.innerHTML = "";

    const tabData = files[tabKey] || {};

    // 控制区：搜索框 + 全部展开/收起
    const controlsDiv = document.createElement("div");
    controlsDiv.className = "tab-controls";

    const searchInput = document.createElement("input");
    searchInput.type = "text";
    searchInput.placeholder = "搜索文件...";
    controlsDiv.appendChild(searchInput);

    const toggleBtn = document.createElement("button");
    toggleBtn.innerText = "全部展开";
    toggleBtn.onclick = () => {
        const expanded = toggleBtn.innerText === "全部收起";
        document.querySelectorAll(".folder-content").forEach(fc => {
            fc.style.display = expanded ? "none" : "block";
        });
        document.querySelectorAll(".folder-title").forEach(ft => {
            ft.classList.toggle("expanded", !expanded);
        });
        toggleBtn.innerText = expanded ? "全部展开" : "全部收起";
    };
    controlsDiv.appendChild(toggleBtn);

    tabContent.appendChild(controlsDiv);

    // 遍历子文件夹
    Object.keys(tabData).forEach(subFolder => {
        const folderTitle = document.createElement("h2");
        folderTitle.className = "folder-title";
        folderTitle.innerText = subFolder;

        const folderContent = document.createElement("div");
        folderContent.className = "folder-content";

        const toolsDiv = document.createElement("div");
        toolsDiv.className = "tools";

        (tabData[subFolder] || []).forEach(f => {
            const card = document.createElement("div");
            card.className = "tool";

            const title = document.createElement("h3");
            title.innerText = f.name;
            card.appendChild(title);

            if (f.status === "download") {
                const btn = document.createElement("button");
                btn.innerText = "下载";
                btn.onclick = () => window.open(f.path, "_blank");
                card.appendChild(btn);
            } else {
                const span = document.createElement("span");
                span.innerText = f.status;
                card.appendChild(span);
            }

            toolsDiv.appendChild(card);
        });

        folderContent.appendChild(toolsDiv);

        folderTitle.onclick = () => {
            const expanded = folderContent.style.display === "block";
            folderContent.style.display = expanded ? "none" : "block";
            folderTitle.classList.toggle("expanded", !expanded);

            const allExpanded = [...document.querySelectorAll(".folder-content")].every(fc => fc.style.display === "block");
            toggleBtn.innerText = allExpanded ? "全部收起" : "全部展开";
        };

        tabContent.appendChild(folderTitle);
        tabContent.appendChild(folderContent);
    });

    // 搜索功能：过滤 + 高亮 + 自动展开
    searchInput.addEventListener("input", () => {
        const query = searchInput.value.toLowerCase();

        const folders = document.querySelectorAll(".folder-content");
        const titles = document.querySelectorAll(".folder-title");

        if (query) {
            // 自动展开所有
            folders.forEach(fc => fc.style.display = "block");
            titles.forEach(ft => ft.classList.add("expanded"));
            toggleBtn.innerText = "全部收起";
        } else {
            // 搜索清空，全部收起
            folders.forEach(fc => fc.style.display = "none");
            titles.forEach(ft => ft.classList.remove("expanded"));
            toggleBtn.innerText = "全部展开";
        }

        document.querySelectorAll(".tool").forEach(card => {
            const titleEl = card.querySelector("h3");
            const text = titleEl.innerText;
            const lower = text.toLowerCase();

            if (!query) {
                card.style.display = "block";
                titleEl.innerHTML = text;
                return;
            }

            if (lower.includes(query)) {
                card.style.display = "block";
                const regex = new RegExp(`(${query})`, "gi");
                titleEl.innerHTML = text.replace(regex, "<mark>$1</mark>");
            } else {
                card.style.display = "none";
                titleEl.innerHTML = text;
            }
        });
    });
}
</script>
</body>
</html>
